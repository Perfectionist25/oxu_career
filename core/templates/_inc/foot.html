{% load static %}
{% load i18n %}

<!-- Кнопка для открытия/закрытия футера -->
<div id="footer-toggle-btn" class="footer-toggle-btn d-flex justify-content-center align-items-center">
    <i class="fas fa-chevron-up" style="transform: rotate(-35deg);"></i>
</div>

<!-- Footer -->
<footer id="main-footer" class="text-white" style="background-color: #012152;">
    <div class="container-fluid px-3 px-md-5 py-4 py-md-5">
        <div class="row g-4">
            <!-- Useful Links -->
            <div class="col-12 col-md-6 col-lg-4">
                <h5 class="text-light fw-bold mb-4">{% trans "Useful Links" %}</h5>
                <ul class="list-unstyled">
                    <li class="mb-3">
                        <a href="https://t.me/AliKhaitov" class="text-light text-decoration-none d-flex align-items-center hover-effect">
                            <i class="fas fa-external-link-alt me-3 fa-fw"></i>
                            <span>{% trans "Developer" %}</span>
                        </a>
                    </li>
                    <li class="mb-3">
                        <a href="/about/" class="text-light text-decoration-none d-flex align-items-center hover-effect">
                            <i class="fas fa-info-circle me-3 fa-fw"></i>
                            <span>{% trans "About University" %}</span>
                        </a>
                    </li>
                    <li class="mb-3">
                        <a href="/news/" class="text-light text-decoration-none d-flex align-items-center hover-effect">
                            <i class="fas fa-newspaper me-3 fa-fw"></i>
                            <span>{% trans "News" %}</span>
                        </a>
                    </li>
                    <li class="mb-3">
                        <a href="/faq/" class="text-light text-decoration-none d-flex align-items-center hover-effect">
                            <i class="fas fa-question-circle me-3 fa-fw"></i>
                            <span>{% trans "FAQ" %}</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Address -->
            <div class="col-12 col-md-6 col-lg-4">
                <h5 class="text-light fw-bold mb-4">{% trans "Address" %}</h5>
                <div class="d-flex align-items-start mb-4">
                    <i class="fas fa-map-marker-alt text-light me-3 mt-1 fa-fw"></i>
                    <a href="https://maps.app.goo.gl/Vak1fFmHn8bcTJqk8" class="text-decoration-none">
                        <p class="text-light mb-0">
                            {% trans "Bukhara city, MFY 'Yangibod'," %}<br>
                            {% trans "G'ijduvon street, 74-house" %}
                        </p>
                    </a>
                </div>
                
                <!-- Map -->
                <div class="mb-4">
                    <div class="ratio ratio-16x9">
                        <iframe 
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d911.3392403764602!2d64.42590351321431!3d39.798748210538605!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3f50093729ce2b27%3A0x4cfc4ffe225f3750!2sOsiyo%20Xalqaro%20Universiteti!5e0!3m2!1sru!2s!4v1763974013257!5m2!1sru!2s" 
                            style="border: 0;" 
                            allowfullscreen 
                            loading="lazy" 
                            referrerpolicy="no-referrer-when-downgrade"
                            class="rounded shadow-sm">
                        </iframe>
                    </div>
                </div>
            </div>

            <!-- Contact -->
            <div class="col-12 col-md-6 col-lg-4">
                <h5 class="text-light fw-bold mb-4">{% trans "Contact" %}</h5>
                
                <!-- Phone -->
                <div class="d-flex align-items-center mb-4">
                    <i class="fas fa-phone text-light me-3 fa-fw"></i>
                    <div>
                        <a href="tel:+998553050009" class="text-light text-decoration-none hover-effect">
                            +998 55 305 00 09
                        </a>
                    </div>
                </div>
                
                <!-- Email -->
                <div class="d-flex align-items-center mb-4">
                    <i class="fas fa-envelope text-light me-3 fa-fw"></i>
                    <div>
                        <a href="mailto:info@oxu.uz" class="text-light text-decoration-none hover-effect">
                            info@oxu.uz
                        </a>
                    </div>
                </div>
                
                <!-- Social Networks -->
                <h6 class="text-light fw-bold mb-3">{% trans "Social Networks" %}</h6>
                <div class="d-flex flex-wrap gap-2 mb-4">
                    <a href="https://t.me/Oxu_uz" class="btn btn-outline-light btn-sm p-2 rounded-circle social-btn" aria-label="Telegram">
                        <i class="fab fa-telegram"></i>
                    </a>
                    <a href="https://www.instagram.com/oxu_uz/" class="btn btn-outline-light btn-sm p-2 rounded-circle social-btn" aria-label="Instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://www.facebook.com/people/Osiyo-Xalqaro-Universiteti/100088012691808/?sk=about" class="btn btn-outline-light btn-sm p-2 rounded-circle social-btn" aria-label="Facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://www.youtube.com/@Osiyo.Xalqaro.Universiteti." class="btn btn-outline-light btn-sm p-2 rounded-circle social-btn" aria-label="YouTube">
                        <i class="fab fa-youtube"></i>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Logo and Copyright -->
        <div class="row pt-4 mt-4 border-top border-light">
            <div class="col-12 col-md-6 d-flex flex-column flex-sm-row align-items-center align-items-sm-start mb-3 mb-md-0">
                <a class="navbar-brand d-flex align-items-center text-decoration-none mb-3 mb-sm-0 me-sm-4" href="/">
                    <img style="width: 60px; height: 60px; object-fit: contain;" src="{% static 'img/logo1.png' %}" alt="OXU Logo" class="me-3">
                    <div class="d-flex flex-column">
                        <span class="fw-bold text-white fs-5">OXU</span>
                        <small class="text-light-50">{% trans "Career" %}</small>
                    </div>
                </a>
            </div>
            <div class="col-12 col-md-6 d-flex align-items-center justify-content-center justify-content-md-end">
                <small class="text-light text-center text-md-end">
                    © {% now 'Y' %} {% trans "All rights reserved. Asia International University" %}
                </small>
            </div>
        </div>
    </div>
</footer>

<style>
    /* Кнопка переключения футера - КОМПАКТНАЯ версия */
    .footer-toggle-btn {
        position: fixed;
        bottom: 15px;
        right: 15px;
        width: 50px;
        height: 50px;
        background-color: #012152;
        color: white;
        border-radius: 50%;
        cursor: pointer;
        z-index: 1001;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .footer-toggle-btn:hover {
        background-color: #013a7a;
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .footer-toggle-btn i {
        font-size: 20px;
        transition: transform 0.3s ease;
    }
    
    /* Футер с анимацией */
    #main-footer {
        position: fixed;
        bottom: -100vh;
        left: 0;
        right: 0;
        z-index: 1000;
        transition: bottom 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        max-height: 85vh;
        overflow-y: auto;
        display: block;
        visibility: hidden;
        border-top-left-radius: 15px;
        border-top-right-radius: 15px;
        box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
        -webkit-overflow-scrolling: touch; /* Для плавной прокрутки на iOS */
        overscroll-behavior: contain; /* Предотвращает закрытие при прокрутке */
    }
    
    #main-footer.active {
        bottom: 0;
        visibility: visible;
    }
    
    /* Хэндл для перетаскивания (только визуальный) */
    #main-footer::before {
        content: '';
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 4px;
        background-color: rgba(255, 255, 255, 0.5);
        border-radius: 2px;
        z-index: 1;
    }
    
    /* Прокрутка внутри футера */
    #main-footer::-webkit-scrollbar {
        width: 6px;
    }
    
    #main-footer::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
    }
    
    #main-footer::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 3px;
    }
    
    /* Оверлей для затемнения фона */
    .footer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease;
        touch-action: none; /* Предотвращает прокрутку под оверлеем */
    }
    
    .footer-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    
    /* Область для свайпа вниз */
    .swipe-handle {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 40px;
        z-index: 2;
        cursor: grab;
    }
    
    .swipe-handle:active {
        cursor: grabbing;
    }
    
    /* Остальные стили */
    .hover-effect {
        transition: all 0.3s ease;
        padding: 4px 8px;
        border-radius: 4px;
    }
    
    .hover-effect:hover {
        background-color: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
        color: #fff !important;
    }
    
    .social-btn {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        border-width: 1.5px;
    }
    
    .social-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    
    .text-light-50 {
        color: rgba(255, 255, 255, 0.7);
    }
    
    .border-light {
        border-color: rgba(255, 255, 255, 0.2) !important;
    }
    
    .fa-fw {
        width: 18px;
        text-align: center;
    }
    
    /* Контейнер футера для лучшей адаптивности */
    #main-footer .container-fluid {
        padding-top: 25px; /* Добавляем отступ для хэндла */
    }
    
    /* Адаптивные стили для мобильных устройств */
    @media (max-width: 768px) {
        .footer-toggle-btn {
            width: 45px;
            height: 45px;
            bottom: 12px;
            right: 12px;
        }
        
        .footer-toggle-btn i {
            font-size: 18px;
        }
        
        #main-footer {
            max-height: 80vh;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        
        #main-footer .container-fluid {
            padding-left: 15px;
            padding-right: 15px;
        }
        
        #main-footer .col {
            margin-bottom: 1.5rem;
        }
        
        #main-footer .col:last-child {
            margin-bottom: 0;
        }
        
        .social-btn {
            width: 38px;
            height: 38px;
        }
        
        .ratio-16x9 {
            --bs-aspect-ratio: 70%;
        }
        
        h5 {
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        .navbar-brand img {
            width: 50px;
            height: 50px;
        }
    }
    
    @media (max-width: 576px) {
        .footer-toggle-btn {
            width: 42px;
            height: 42px;
            bottom: 10px;
            right: 10px;
        }
        
        #main-footer {
            max-height: 75vh;
        }
        
        #main-footer .container-fluid {
            padding: 20px 15px;
        }
        
        .social-btn {
            width: 36px;
            height: 36px;
        }
        
        /* Оптимизация для очень маленьких экранов */
        .col-12 {
            padding-left: 8px;
            padding-right: 8px;
        }
    }
    
    @media (max-width: 360px) {
        .footer-toggle-btn {
            width: 40px;
            height: 40px;
            bottom: 8px;
            right: 8px;
        }
        
        .footer-toggle-btn i {
            font-size: 16px;
        }
        
        .social-btn {
            width: 34px;
            height: 34px;
            padding: 0.4rem;
        }
        
        #main-footer .container-fluid {
            padding-left: 10px;
            padding-right: 10px;
        }
        
        h5 {
            font-size: 0.95rem;
        }
    }
    
    /* Для темной темы */
    @media (prefers-color-scheme: dark) {
        #main-footer {
            background-color: #001a3d !important;
        }
        
        .footer-toggle-btn {
            background-color: #001a3d;
        }
        
        .footer-toggle-btn:hover {
            background-color: #002d5c;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const footer = document.getElementById('main-footer');
        const toggleBtn = document.getElementById('footer-toggle-btn');
        const icon = toggleBtn.querySelector('i');
        let isFooterOpen = false;
        let isAnimating = false;
        let isScrolling = false;
        let scrollTimeout;
        let touchStartY = 0;
        let isSwiping = false;
        let swipeStartY = 0;
        let footerStartBottom = 0;
        
        // Создаем оверлей для затемнения фона
        const overlay = document.createElement('div');
        overlay.className = 'footer-overlay';
        document.body.appendChild(overlay);
        
        // Создаем область для свайпа
        const swipeHandle = document.createElement('div');
        swipeHandle.className = 'swipe-handle';
        footer.insertBefore(swipeHandle, footer.firstChild);
        
        // Начальное состояние - футер скрыт
        footer.style.bottom = '-100vh';
        footer.style.visibility = 'hidden';
        // Иконка уже повернута на -35deg в HTML
        
        // Функция открытия футера
        function openFooter() {
            if (isAnimating) return;
            
            isAnimating = true;
            isFooterOpen = true;
            
            // Показываем оверлей
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Показываем футер с анимацией
            footer.style.visibility = 'visible';
            footer.classList.add('active');
            footer.style.bottom = '0';
            
            // Поворачиваем иконку на 35 градусов (145deg от начального)
            icon.style.transform = 'rotate(145deg)';
            
            // Разрешаем анимацию снова
            setTimeout(() => {
                isAnimating = false;
            }, 400);
        }
        
        // Функция закрытия футера
        function closeFooter() {
            if (isAnimating) return;
            
            isAnimating = true;
            isFooterOpen = false;
            
            // Скрываем оверлей
            overlay.classList.remove('active');
            document.body.style.overflow = '';
            
            // Скрываем футер с анимацией
            footer.style.bottom = '-100vh';
            
            // Поворачиваем иконку обратно на -35 градусов
            icon.style.transform = 'rotate(-35deg)';
            
            // После анимации скрываем видимость
            setTimeout(() => {
                footer.classList.remove('active');
                footer.style.visibility = 'hidden';
                isAnimating = false;
            }, 400);
        }
        
        // Функция переключения футера
        function toggleFooter() {
            if (isFooterOpen) {
                closeFooter();
            } else {
                openFooter();
            }
        }
        
        // Обработчик клика на кнопку
        toggleBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            toggleFooter();
        });
        
        // Обработчик клика на оверлей для закрытия
        overlay.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            if (isFooterOpen) {
                closeFooter();
            }
        });
        
        // Обработчики для свайпа вниз на handle
        swipeHandle.addEventListener('touchstart', function(e) {
            e.stopPropagation();
            isSwiping = true;
            swipeStartY = e.touches[0].clientY;
            footerStartBottom = parseFloat(footer.style.bottom) || 0;
        }, { passive: true });
        
        swipeHandle.addEventListener('touchmove', function(e) {
            if (!isSwiping) return;
            e.preventDefault();
            e.stopPropagation();
            
            const currentY = e.touches[0].clientY;
            const deltaY = currentY - swipeStartY;
            
            // Свайп вниз для закрытия
            if (deltaY > 0) {
                const newBottom = Math.min(0, footerStartBottom - deltaY / 2);
                footer.style.bottom = newBottom + 'px';
                
                // Затемняем оверлей пропорционально
                const opacity = 1 - (deltaY / 200);
                overlay.style.opacity = Math.max(0, opacity);
            }
        }, { passive: false });
        
        swipeHandle.addEventListener('touchend', function(e) {
            if (!isSwiping) return;
            e.stopPropagation();
            
            const endY = e.changedTouches[0].clientY;
            const deltaY = endY - swipeStartY;
            
            if (deltaY > 100) { // Минимальный свайп 100px для закрытия
                closeFooter();
            } else {
                // Возвращаем на место
                footer.style.bottom = '0';
                overlay.style.opacity = '1';
            }
            
            isSwiping = false;
            overlay.style.opacity = ''; // Сбрасываем кастомную прозрачность
        }, { passive: true });
        
        // Предотвращаем закрытие при прокрутке внутри футера
        footer.addEventListener('touchstart', function(e) {
            // Если касание не в области свайпа, разрешаем прокрутку
            if (!swipeHandle.contains(e.target)) {
                isScrolling = true;
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                }, 100);
            }
        }, { passive: true });
        
        footer.addEventListener('touchmove', function(e) {
            // Если это прокрутка внутри футера, не обрабатываем как свайп для закрытия
            if (isScrolling) {
                e.stopPropagation();
            }
        }, { passive: false });
        
        // Закрытие футера при нажатии Escape
        document.addEventListener('keydown', function(event) {
            if (isFooterOpen && event.key === 'Escape') {
                closeFooter();
            }
        });
        
        // Обработчик для сенсорных устройств
        toggleBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        toggleBtn.addEventListener('touchend', function(e) {
            e.preventDefault();
            toggleFooter();
        }, { passive: false });
        
        // Закрытие при клике на ссылку внутри футера (опционально)
        footer.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function() {
                setTimeout(() => {
                    if (isFooterOpen) {
                        closeFooter();
                    }
                }, 300);
            });
        });
        
        // Предотвращаем закрытие при клике внутри футера (кроме области свайпа)
        footer.addEventListener('click', function(event) {
            if (!swipeHandle.contains(event.target)) {
                event.stopPropagation();
            }
        });
    });
</script>