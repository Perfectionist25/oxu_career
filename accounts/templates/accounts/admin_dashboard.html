<!-- templates/accounts/admin_dashboard.html -->
{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Admin Panel" %}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Заголовок -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 fw-bold text-primary mb-1">{% trans "Admin Panel" %}</h1>
                    <p class="text-muted mb-0">
                        {% trans "System Management" %} |
                        <strong style="color: black;">{{ user.get_full_name|default:user.username }}</strong>
                        {% if user.is_main_admin %}({% trans "Main Admin" %}){% endif %}
                    </p>
                </div>
                <div class="text-end">
                    <small class="text-muted d-block">{% trans "Last Activity" %}:</small>
                    <small class="text-muted">
                        {% now "H:i" %} {% trans "hour" %}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Статистика системы -->
    <div class="row mb-1">
        <div class="col">
            <div class="card border-0 bg-primary text-white shadow-sm">
                <div class="card-body text-center py-4">
                    <i class="fas fa-users fa-2x mb-2 opacity-50"></i>
                    <div class="fw-bold mb-1 h4">{{ stats.total_users|default:0 }}</div>
                    <small>{% trans "Total Users" %}</small>
                </div>
            </div>
        </div>
        
        <div class="col">
            <div class="card border-0 bg-success text-white shadow-sm">
                <div class="card-body text-center py-4">
                    <i class="fas fa-graduation-cap fa-2x mb-2 opacity-50"></i>
                    <div class="fw-bold mb-1 h4">{{ stats.total_students|default:0 }}</div>
                    <small>{% trans "Students" %}</small>
                </div>
            </div>
        </div>
        
        <div class="col">
            <div class="card border-0 bg-info text-white shadow-sm">
                <div class="card-body text-center py-4">
                    <i class="fas fa-building fa-2x mb-2 opacity-50"></i>
                    <div class="fw-bold mb-1 h4">{{ stats.total_employers|default:0 }}</div>
                    <small>{% trans "Employers" %}</small>
                </div>
            </div>
        </div>
        
        <div class="col">
            <div class="card border-0 bg-warning text-dark shadow-sm">
                <div class="card-body text-center py-4">
                    <i class="fas fa-briefcase fa-2x mb-2 opacity-50"></i>
                    <div class="fw-bold mb-1 h4">{{ stats.total_jobs|default:0 }}</div>
                    <small>{% trans "Jobs" %}</small>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card border-0 bg-secondary text-white shadow-sm">
                <div class="card-body text-center py-4">
                    <i class="fas fa-file-alt fa-2x mb-2 opacity-50"></i>
                    <div class="fw-bold mb-1 h4">{{ stats.total_resumes|default:0 }}</div>
                    <small>{% trans "Resumes" %}</small>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card border-0 bg-dark text-white shadow-sm">
                <div class="card-body text-center py-4">
                    <i class="fas fa-user-clock fa-2x mb-2 opacity-50"></i>
                    <div class="fw-bold mb-1 h4">{{ stats.active_today|default:0 }}</div>
                    <small>{% trans "Active Today" %}</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Действия администратора -->
    <div class="row mb-5">
        <div class="col-12">
            <h4 class="fw-bold text-dark mb-4">{% trans "Control Panel" %}</h4>
            <div class="row g-3">
                {% if user.is_main_admin %}
                <div class="col-xl-2 col-md-3 col-6">
                    <a href="{% url 'accounts:create_admin_account' %}" class="btn btn-primary w-100 h-100 py-4">
                        <i class="fas fa-user-plus fa-2x mb-2"></i>
                        <div>{% trans "New Admin" %}</div>
                    </a>
                </div>
                {% endif %}
                
                <div class="col-xl-2 col-md-3 col-6">
                    <a href="{% url 'accounts:create_employer_account' %}" class="btn btn-success w-100 h-100 py-4">
                        <i class="fas fa-building fa-2x mb-2"></i>
                        <div>{% trans "New Employer" %}</div>
                    </a>
                </div>
                
                <div class="col-xl-2 col-md-3 col-6">
                    <a href="{% url 'accounts:user_management' %}" class="btn btn-info w-100 h-100 py-4">
                        <i class="fas fa-users-cog fa-2x mb-2"></i>
                        <div>{% trans "Users" %}</div>
                    </a>
                </div>
                
                <div class="col-xl-2 col-md-3 col-6">
                    <a href="{% url 'jobs:list' %}" class="btn btn-warning w-100 h-100 py-4" onclick="alert('{% trans "Tez orada qo'shiladi" %}')">
                        <i class="fas fa-briefcase fa-2x mb-2"></i>
                        <div>{% trans "Jobs" %}</div>
                    </a>
                </div>
                
                <div class="col-xl-2 col-md-3 col-6">
                    <a href="{% url 'cvbuilder:public_cv_list' %}" class="btn btn-secondary w-100 h-100 py-4" onclick="alert('{% trans "Coming soon" %}')">
                        <i class="fas fa-file-alt fa-2x mb-2"></i>
                        <div>{% trans "Resumes" %}</div>
                    </a>
                </div>
                
                <div class="col-xl-2 col-md-3 col-6">
                    <a href="{% url 'events:admin_event_list' %}" class="btn btn-info w-100 h-100 py-4">
                        <i class="fas fa-calendar-alt fa-2x mb-2"></i>
                        <div>{% trans "Events" %}</div>
                    </a>
                </div>

                <div class="col-xl-2 col-md-3 col-6">
                    <a href="#" class="btn btn-dark w-100 h-100 py-4" onclick="alert('{% trans "Tez orada qo'shiladi" %}')">
                        <i class="fas fa-chart-bar fa-2x mb-2"></i>
                        <div>{% trans "Statistics" %}</div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Последняя активность и быстрая статистика -->
    <div class="row">
        <!-- Последняя активность -->
        <div class="col-lg-8 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold mb-0">{% trans "Recent System Activity" %}</h5>
                    <a href="{% url 'accounts:user_management' %}" class="btn btn-sm btn-outline-primary">{% trans "View All" %}</a>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th style="color: black;">{% trans "User" %}</th>
                                    <th style="color: black;">{% trans "Activity" %}</th>
                                    <th style="color: black;">{% trans "Time" %}</th>
                                    <th style="color: black;">{% trans "IP" %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for activity in recent_activities %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            {% if activity.user.avatar %}
                                            <img src="{{ activity.user.avatar.url }}" alt="{{ activity.user.username }}" 
                                                 class="rounded-circle me-2" width="30" height="30">
                                            {% else %}
                                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-2" 
                                                 style="width: 30px; height: 30px;">
                                                <i class="fas fa-user text-white" style="font-size: 12px;"></i>
                                            </div>
                                            {% endif %}
                                            <div>
                                                <div class="fw-bold">{{ activity.user.get_full_name|default:activity.user.username }}</div>
                                                <small class="text-muted">
                                                    {{ activity.user.get_user_type_display|default:"Foydalanuvchi" }}
                                                </small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">
                                            {{ activity.description|default:activity.activity_type }}
                                        </span>
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ activity.created_at|timesince }} {% trans "ago" %}</small>
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ activity.ip_address|default:"-" }}</small>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center text-muted py-4">
                                        {% trans "No activity yet" %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Быстрая статистика -->
        <div class="col-lg-4 mb-4">
            <!-- Статистика за неделю -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h5 class="fw-bold mb-0">{% trans "Weekly Growth" %}</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>{% trans "New Students" %}</span>
                        <span class="badge bg-success">+{{ stats.new_this_week|default:0 }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>{% trans "New Employers" %}</span>
                        <span class="badge bg-info">+{{ stats.new_employers_week|default:0 }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>{% trans "New Jobs" %}</span>
                        <span class="badge bg-warning">+{{ stats.new_jobs_week|default:0 }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span>{% trans "New Resumes" %}</span>
                        <span class="badge bg-secondary">+{{ stats.new_resumes_week|default:0 }}</span>
                    </div>
                </div>
            </div>

            <!-- Системная информация -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="fw-bold mb-0">{% trans "System Status" %}</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small>{% trans "Server Time" %}</small>
                        <small class="text-muted" id="server-time">{% now "H:i" %}</small>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small>{% trans "System Version" %}</small>
                        <small class="text-muted">v1.0.0</small>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <small>{% trans "Last Backup" %}</small>
                        <small class="text-muted">{% now "d.m.Y" %}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Обновление времени сервера
function updateServerTime() {
    const now = new Date();
    document.getElementById('server-time').textContent = 
        now.getHours().toString().padStart(2, '0') + ':' + 
        now.getMinutes().toString().padStart(2, '0');
}
setInterval(updateServerTime, 60000);
</script>
{% endblock %}