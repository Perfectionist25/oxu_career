<!-- templates/accounts/user_detail.html -->
{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ user.get_full_name|default:user.username }} - {% trans "Profile" %}{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Заголовок и навигация -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'accounts:admin_dashboard' %}">{% trans "Admin" %}</a></li>
                            <li class="breadcrumb-item"><a href="{% url 'accounts:user_management' %}">{% trans "Users" %}</a></li>
                            <li class="breadcrumb-item active">{{ user.get_full_name|default:user.username }}</li>
                        </ol>
                    </nav>
                    <h1 class="h3 fw-bold text-primary mb-1">{{ user.get_full_name|default:user.username }}</h1>
                    <p class="text-muted mb-0">{{ user.email }}</p>
                </div>
                <div class="text-end">
                    <span class="badge 
                        {% if user.is_student %}bg-success
                        {% elif user.is_employer %}bg-info
                        {% elif user.is_admin %}bg-warning
                        {% elif user.is_main_admin %}bg-danger
                        {% else %}bg-secondary{% endif %} fs-6">
                        {{ user.get_user_type_display }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Основная информация -->
        <div class="col-lg-4 mb-4">
            <!-- Карточка пользователя -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body text-center">
                    {% if user.avatar %}
                    <img src="{{ user.avatar.url }}" alt="{{ user.username }}" 
                         class="rounded-circle mb-3" width="120" height="120" style="object-fit: cover;">
                    {% else %}
                    <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" 
                         style="width: 120px; height: 120px;">
                        <i class="fas fa-user text-white fa-3x"></i>
                    </div>
                    {% endif %}
                    
                    <h5 class="fw-bold">{{ user.get_full_name|default:user.username }}</h5>
                    <p class="text-muted mb-3">{{ user.email }}</p>
                    
                    <div class="d-flex justify-content-center gap-2 mb-3">
                        {% if user.is_active %}
                        <span class="badge bg-success">{% trans "Faol" %}</span>
                        {% else %}
                        <span class="badge bg-danger">{% trans "Nofaol" %}</span>
                        {% endif %}
                        
                        {% if user.is_verified %}
                        <span class="badge bg-info">{% trans "Tasdiqlangan" %}</span>
                        {% endif %}
                        
                        {% if user.is_employer and user.is_active_employer %}
                        <span class="badge bg-primary">{% trans "Faol ish beruvchi" %}</span>
                        {% endif %}
                    </div>

                    {% if not user.is_main_admin %}
                    <form method="post" action="{% url 'accounts:toggle_user_status' user.id %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn {% if user.is_active %}btn-warning{% else %}btn-success{% endif %} btn-sm">
                            <i class="fas {% if user.is_active %}fa-times{% else %}fa-check{% endif %} me-1"></i>
                            {% if user.is_active %}{% trans "Deactivate" %}{% else %}{% trans "Activate" %}{% endif %}
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>

            <!-- Контактная информация -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h6 class="fw-bold mb-0">{% trans "Kontakt ma'lumotlari" %}</h6>
                </div>
                <div class="card-body">
                    {% if user.phone_number %}
                    <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-phone text-muted me-2"></i>
                        <span>{{ user.phone_number }}</span>
                    </div>
                    {% endif %}
                    
                    {% if user.country %}
                    <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-map-marker-alt text-muted me-2"></i>
                        <span>{{ user.country.name }}{% if user.city %}, {{ user.city }}{% endif %}</span>
                    </div>
                    {% endif %}
                    
                    {% if profile %}
                        {% if user.is_employer and profile.company_phone %}
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-building text-muted me-2"></i>
                            <span>{{ profile.company_phone }}</span>
                        </div>
                        {% endif %}
                    {% endif %}

                    <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-calendar text-muted me-2"></i>
                        <span>{% trans "Ro'yxatdan o'tgan" %}: {{ user.date_joined|date:"d.m.Y" }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Детальная информация -->
        <div class="col-lg-8">
            <!-- Информация профиля -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h6 class="fw-bold mb-0">{% trans "Profil ma'lumotlari" %}</h6>
                </div>
                <div class="card-body">
                    {% if user.is_student and profile %}
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{% trans "Fakultet" %}:</strong> {{ profile.faculty|default:"-" }}</p>
                            <p><strong>{% trans "Mutaxassislik" %}:</strong> {{ profile.specialty|default:"-" }}</p>
                            <p><strong>{% trans "Ta'lim darajasi" %}:</strong> {{ profile.get_education_level_display|default:"-" }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{% trans "O'rtacha baho" %}:</strong> {{ profile.gpa|default:"-" }}</p>
                            <p><strong>{% trans "Bitirish yili" %}:</strong> {{ profile.graduation_year|default:"-" }}</p>
                            <p><strong>{% trans "Istagan lavozim" %}:</strong> {{ profile.desired_position|default:"-" }}</p>
                        </div>
                    </div>
                    {% elif user.is_employer and profile %}
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{% trans "Kompaniya" %}:</strong> {{ profile.company_name }}</p>
                            <p><strong>{% trans "Soha" %}:</strong> {{ profile.industry|default:"-" }}</p>
                            <p><strong>{% trans "Kompaniya hajmi" %}:</strong> {{ profile.get_company_size_display|default:"-" }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{% trans "Tashkil etilgan yil" %}:</strong> {{ profile.founded_year|default:"-" }}</p>
                            <p><strong>{% trans "Bosh qarorgoh" %}:</strong> {{ profile.headquarters|default:"-" }}</p>
                            <p><strong>{% trans "E'lon qilingan ishlar" %}:</strong> {{ profile.jobs_posted }}</p>
                        </div>
                    </div>
                    {% if profile.company_description %}
                    <div class="mt-3">
                        <strong>{% trans "Kompaniya haqida" %}:</strong>
                        <p class="mb-0">{{ profile.company_description }}</p>
                    </div>
                    {% endif %}
                    {% elif user.is_admin and profile %}
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{% trans "Talabalarni boshqarish" %}:</strong> 
                                {% if profile.can_manage_students %}<i class="fas fa-check text-success"></i>{% else %}<i class="fas fa-times text-danger"></i>{% endif %}
                            </p>
                            <p><strong>{% trans "Ish beruvchilarni boshqarish" %}:</strong> 
                                {% if profile.can_manage_employers %}<i class="fas fa-check text-success"></i>{% else %}<i class="fas fa-times text-danger"></i>{% endif %}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{% trans "Vakansiyalarni boshqarish" %}:</strong> 
                                {% if profile.can_manage_jobs %}<i class="fas fa-check text-success"></i>{% else %}<i class="fas fa-times text-danger"></i>{% endif %}
                            </p>
                            <p><strong>{% trans "Statistikalarni ko'rish" %}:</strong> 
                                {% if profile.can_view_statistics %}<i class="fas fa-check text-success"></i>{% else %}<i class="fas fa-times text-danger"></i>{% endif %}
                            </p>
                        </div>
                    </div>
                    {% else %}
                    <p class="text-muted mb-0">{% trans "Qo'shimcha profil ma'lumotlari mavjud emas" %}</p>
                    {% endif %}
                </div>
            </div>

            <!-- История активности -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="fw-bold mb-0">{% trans "Faollik tarixi" %}</h6>
                    <small class="text-muted">{% trans "So'nggi 20 ta harakat" %}</small>
                </div>
                <div class="card-body">
                    {% if activities %}
                    <div class="timeline">
                        {% for activity in activities %}
                        <div class="timeline-item mb-3">
                            <div class="d-flex">
                                <div class="flex-shrink-0">
                                    <div class="timeline-icon bg-{{ activity.activity_type|default:'primary' }} text-white rounded-circle d-flex align-items-center justify-content-center"
                                         style="width: 30px; height: 30px;">
                                        <i class="fas fa-{{ activity.activity_type|default:'circle' }} fa-sm"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <div class="d-flex justify-content-between">
                                        <strong>{{ activity.get_activity_type_display }}</strong>
                                        <small class="text-muted">{{ activity.created_at|timesince }} {% trans "oldin" %}</small>
                                    </div>
                                    <p class="mb-1 small">{{ activity.description }}</p>
                                    {% if activity.ip_address %}
                                    <small class="text-muted">IP: {{ activity.ip_address }}</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted text-center py-3">{% trans "Hozircha faollik mavjud emas" %}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.timeline-icon {
    font-size: 12px;
}

.card {
    border-radius: 12px;
}

.breadcrumb {
    background: transparent;
    padding: 0;
}

.timeline-item {
    border-left: 2px solid #e9ecef;
    padding-left: 15px;
    margin-left: 15px;
}
</style>
{% endblock %}